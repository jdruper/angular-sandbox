<div class="inventory-dashboard">
  <header class="dashboard-header">
    <h1>Barcode Audit Dashboard</h1>
    <p class="subtitle">Sandbox Pattern PWA Example - Offline-First Audit Management</p>
    
    <!-- PWA Status Indicators -->
    <div class="status-indicators">
      <!-- Network Status -->
      <div class="network-status" [class.offline]="isOffline()">
        @if (isOnline()) {
          <span class="status-dot online"></span>
          <span>Online</span>
        } @else {
          <span class="status-dot offline"></span>
          <span>Offline</span>
        }
      </div>

      <!-- Sync Status -->
      @if (pendingAuditsCount() > 0 || isSyncing()) {
        <div class="sync-status">
          @if (isSyncing()) {
            <span class="status-dot syncing"></span>
            <span>Syncing...</span>
          } @else {
            <span class="status-dot pending"></span>
            <span>{{ pendingAuditsCount() }} pending</span>
            @if (isOnline()) {
              <button class="sync-btn" (click)="syncToServer()">Sync</button>
            }
          }
        </div>
      }

      <!-- Sync Error -->
      @if (syncError()) {
        <div class="sync-error">
          <span>Sync error: {{ syncError() }}</span>
          <button class="close-btn" (click)="clearSyncError()">×</button>
        </div>
      }
    </div>
  </header>

  <!-- Error Display -->
  @if (error()) {
    <div class="error-banner">
      <span>{{ error() }}</span>
      <button class="close-btn" (click)="clearError()">×</button>
    </div>
  }

  <!-- Dashboard Stats - Presentation Component -->
  <app-dashboard-stats
    [totalItems]="auditCount()"
    [totalValue]="auditSummary().syncedAudits"
    [lowStockCount]="auditSummary().pendingAudits"
    [loading]="loading()"
  />

  <!-- Audit List - Presentation Component -->
  <section class="items-section">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
      <h2>Audit Records</h2>
      <button 
        (click)="addTestAudit()" 
        style="padding: 0.5rem 1rem; background: #3b82f6; color: white; border: none; border-radius: 4px; cursor: pointer;">
        Add Test Audit
      </button>
    </div>
    <!-- Simple audit list for now - can be enhanced later -->
    @if (loading()) {
      <div class="loading">Loading audit records...</div>
    } @else if (audits().length === 0) {
      <div class="empty-state">No audit records found</div>
    } @else {
      <div class="audit-list">
        @for (audit of audits(); track audit.externalId) {
          <div class="audit-card" [class.pending]="!audit.synced">
            <div class="audit-header">
              <h4>{{ audit.slotNumber }}</h4>
              <span class="sync-status" [class.synced]="audit.synced">
                {{ audit.synced ? 'Synced' : 'Pending' }}
              </span>
            </div>
            <div class="audit-details">
              <div><strong>Barcode:</strong> {{ audit.primaryBarcode }}</div>
              <div><strong>Location:</strong> {{ audit.warehouseLocation }}</div>
              <div><strong>Auditor:</strong> {{ audit.auditors }}</div>
              <div><strong>Date:</strong> {{ audit.dateReceived | date:'short' }}</div>
            </div>
            <div class="audit-actions">
              <button (click)="onAuditSelected(audit)">View</button>
              <button (click)="onAuditDeleted(audit.externalId)" class="delete-btn">Delete</button>
            </div>
          </div>
        }
      </div>
    }
  </section>

  <!-- Selected Audit Details -->
  @if (selectedAudit()) {
    <section class="selected-item">
      <h3>Selected Audit Details</h3>
      <div class="item-details-card">
        <h4>Slot: {{ selectedAudit()!.slotNumber }}</h4>
        <p>{{ selectedAudit()!.comments }}</p>
        <div class="details-grid">
          <div><strong>Barcode:</strong> {{ selectedAudit()!.primaryBarcode }}</div>
          <div><strong>Logistics:</strong> {{ selectedAudit()!.warehouseLogistics }}</div>
          <div><strong>Location:</strong> {{ selectedAudit()!.warehouseLocation }}</div>
          <div><strong>Auditor:</strong> {{ selectedAudit()!.auditors }}</div>
          <div><strong>Date:</strong> {{ selectedAudit()!.dateReceived | date:'short' }}</div>
          <div><strong>Time:</strong> {{ selectedAudit()!.timeReceived }}</div>
        </div>
      </div>
    </section>
  }
</div>
